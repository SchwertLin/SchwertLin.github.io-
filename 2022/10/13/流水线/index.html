<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="author" content="Schwertlilien"/><meta name="keyword"/><meta name="description" content="流水线流水线的定义：将一重复的处理过程分解为若干子过程，每一个子过程都可有效地在其专用功能段上与其他子过程同时执行，这种技术成为流水线技术。 一、流水线的特点 流水过程由多个相关的子过程组成，这些子过程称为流水线的“级”或“段”。段的数目称为流水线的“深度”。 每个子过程由专用的功能段实现，各功能段的时间应基本相等，通常为1个时钟周期。 流水线需要经过一定的通过时间(CD时间)才能稳定。 流水技术">
<meta property="og:type" content="article">
<meta property="og:title" content="流水线">
<meta property="og:url" content="http://example.com/2022/10/13/%E6%B5%81%E6%B0%B4%E7%BA%BF/index.html">
<meta property="og:site_name" content="Schwertlilien">
<meta property="og:description" content="流水线流水线的定义：将一重复的处理过程分解为若干子过程，每一个子过程都可有效地在其专用功能段上与其他子过程同时执行，这种技术成为流水线技术。 一、流水线的特点 流水过程由多个相关的子过程组成，这些子过程称为流水线的“级”或“段”。段的数目称为流水线的“深度”。 每个子过程由专用的功能段实现，各功能段的时间应基本相等，通常为1个时钟周期。 流水线需要经过一定的通过时间(CD时间)才能稳定。 流水技术">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2022/10/11/xNgcuR.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/10/11/xNIDXD.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/10/12/xU9TzD.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/10/13/xd3T4x.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/10/13/xdyYe1.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/10/13/xd6mXd.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/10/13/xdc0rd.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/10/13/xdgOtP.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/10/13/xd2lA1.png">
<meta property="og:image" content="https://s1.ax1x.com/2022/10/13/xd2540.png">
<meta property="article:published_time" content="2022-10-13T14:25:37.000Z">
<meta property="article:modified_time" content="2022-10-13T14:26:50.115Z">
<meta property="article:author" content="Schwertlilien">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="计算机组成原理">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2022/10/11/xNgcuR.png"><title>流水线 - MEOW - 可爱明亮的Hexo主题</title><link rel="shortcut icon" href="/img/site-icon.png">
<link rel="stylesheet" href="/css/style.css" id="dm-light">


<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
<meta name="generator" content="Hexo 7.3.0"></head><body><header><div class="top-nav" ondblclick="scrollToTop()"><div class="nav-info"><div class="nav-icon"><img id="nav-icon" src="/img/site-icon.png"/></div><div class="nav-title"><a id="nav-title" href="/" title="主页">Schwertlilien</a></div></div><div class="nav-ribbon"><div class="top-menu-expanded"><a class="top-menu-item" href="/archives"><span>归档</span></a><a class="top-menu-item" href="/categories"><span>分类</span></a><a class="top-menu-item" href="/tags"><span>标签</span></a><a class="top-menu-item" href="/about"><span>关于</span></a></div><div class="top-search" onclick="toggleSearchWindow()"><div id="top-search-btn" title="搜索"><i class="icon fa-solid fa-magnifying-glass"></i><span>搜索</span></div></div><div id="top-menu-btn" onclick="openTopMenu()" title="打开菜单"><i class="fa-solid fa-bars fa-lg"></i></div></div></div></header><div id="top-menu-hidden"><div class="menu-hidden-content"><div class="menu-hidden-nav"><a class="menu-hidden-item" href="/archives"><i class="fa-solid fa-box-archive fa-sm"></i><span>归档</span></a><a class="menu-hidden-item" href="/categories"><i class="fa-regular fa-folder-open fa-sm"></i><span>分类</span></a><a class="menu-hidden-item" href="/tags"><i class="fa-solid fa-tags fa-sm"></i><span>标签</span></a><a class="menu-hidden-item" href="/about"><i class="fa-solid fa-paw fa-sm"></i><span>关于</span></a></div></div><div class="menu-hidden-blank" onclick="closeTopMenu()"></div></div>
<div class="blog-info"><div class="blog-pic"><img id="blog-pic" src="/img/site-icon.png"/></div><div class="blog-title"><i class="fa-solid fa-paw fa-2xs fa-rotate-by"></i><span>MEOW</span><i class="fa-solid fa-paw fa-2xs fa-rotate-by"></i></div><div class="blog-desc">Hexo主题「Meow」展示站。本主题尤其适用于发布原创小说、同人二创等文学作品。</div></div><div class="main"><div class="main-content"><article class="post"><div class="post-title"><h1><i class="fa-solid fa-paw"></i>流水线</h1></div><div class="post-info"><div class="post-info-first-line"><div class="post-date"><i class="icon fa-regular fa-calendar-plus" title="发布日期"></i><time class="publish-time">2022-10-13</time><i class="icon fa-regular fa-calendar-check" title="更新日期"></i><time class="update-time">2022-10-13</time></div>

<div class="post-tags"><i class="icon fa-solid fa-tags" title="标签"></i><a class="post-tag" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><i class="icon fa-solid fa-tags" title="标签"></i><a class="post-tag" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/">计算机组成原理</a></div></div><div class="post-info-second-line"><div class="post-copyright"><i class="icon fa-brands fa-creative-commons" title="版权声明"></i><span>版权声明: </span><a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh-hans" title="CC BY-NC-ND 4.0">署名-非商业性使用-禁止演绎 4.0</a></div>
<div class="post-word-count"><i class="icon fa-solid fa-pen-to-square"></i><span>全文约4.3K字</span></div><div class="pageview-post"><i class="icon fa-regular fa-eye"></i><span id="busuanzi_container_page_pv">阅读次数: <span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner"></i></span></span></div></div></div><div class="post-content"><h1 id="流水线"><a href="#流水线" class="headerlink" title="流水线"></a>流水线</h1><p>流水线的定义：将一<strong>重复的处理过程</strong>分解为若干子过程，每一个子过程都可有效地在其专用功能段上与其他子过程<strong>同时执行</strong>，这种技术成为流水线技术。</p>
<h2 id="一、流水线的特点"><a href="#一、流水线的特点" class="headerlink" title="一、流水线的特点"></a>一、流水线的特点</h2><ul>
<li>流水过程由多个相关的子过程组成，这些子过程称为流水线的“级”或“段”。段的数目称为流水线的“深度”。</li>
<li>每个子过程由专用的功能段实现，各功能段的时间应基本相等，通常为1个时钟周期。</li>
<li>流水线需要经过一定的通过时间(CD时间)才能稳定。</li>
<li>流水技术适合于大量重复的时序过程，且是并行处理。</li>
<li>它不能缩短单个任务的响应时间，但是可以提高吞吐率。</li>
</ul>
<h2 id="二、流水线类型"><a href="#二、流水线类型" class="headerlink" title="二、流水线类型"></a>二、流水线类型</h2><p><strong>1. 按流水线所完成的功能分类</strong></p>
<ul>
<li>单功能流水线：<em>只能完成一种固定功能</em></li>
<li>多功能流水线：<em>各段可以进行不同的连接，有很多的类型，但是选取其中的几个，可以完成不同的功能</em></li>
</ul>
<p><img src="https://s1.ax1x.com/2022/10/11/xNgcuR.png"></p>
<p><strong>2. 按同一时间内流水线的连接方式划分</strong></p>
<ul>
<li>静态流水线：<em>同一时间内，流水线各段只能完成某一种功能</em></li>
<li>动态流水线：<em>同一时间内，流水线各段可以完成不同的功能，比如又做加减、又做乘除</em></li>
</ul>
<blockquote>
<p>PS：动态流水线使得流水线的控制变得很复杂。</p>
</blockquote>
<p><strong>3. 按照流水的级别划分</strong></p>
<ul>
<li>部件级流水线：<em>处理机的算术逻辑部件分段</em></li>
<li>处理机级流水线：<em>解释指令的过程分段，比如分为取指、计算、存放</em></li>
<li>处理机间流水线：<em>不同的处理机对同一数据进行处理</em></li>
</ul>
<blockquote>
<p>PS：部件级与处理机级比较常见，而处理机间流水线更常用于OS。</p>
</blockquote>
<p><strong>4. 按照是否有反馈回路来进行分类</strong></p>
<ul>
<li>线性流水线：<em>各段串行连接，无反馈回路</em></li>
<li>非线性流水线：<em>有反馈回路</em></li>
</ul>
<blockquote>
<p>流水线调度：什么时候向流水线引入新的输入，从而使新输入的数据和先前操作的反馈数据在流水线中不产生冲突。</p>
</blockquote>
<p><strong>5. 按照输出端任务流出顺序与输入端任务流入顺序是否相同划分</strong></p>
<ul>
<li>顺序流动流水线：<em>顺序流入，顺序流出</em></li>
<li>乱序流动流水线：<em>顺序流入、乱序流出</em></li>
</ul>
<h2 id="三、流水线的性能分析"><a href="#三、流水线的性能分析" class="headerlink" title="三、流水线的性能分析"></a>三、流水线的性能分析</h2><p>主要是三项性能指标：<strong>吞吐率、加速比、效率</strong></p>
<h3 id="1-吞吐率"><a href="#1-吞吐率" class="headerlink" title="(1)吞吐率"></a>(1)吞吐率</h3><p>吞吐率：单位时间内流水线所完成的任务数or输出结果的数量。</p>
<h4 id="a-最大吞吐率"><a href="#a-最大吞吐率" class="headerlink" title="a.最大吞吐率"></a>a.最大吞吐率</h4><p>最大吞吐率$TP_{max}$：<strong>流水线到达稳定状态后的吞吐率</strong></p>
<ol>
<li><p>流水线各段时间相等，均为$\Delta t_0$：<br>$$<br>TP_{max}&#x3D;\frac{1}{\Delta t_0}<br>$$</p>
</li>
<li><p>流水线各段时间不等，第$i$段时间为$\Delta t_i$($TP_{max}$取决于流水线中最慢一段所需时间，即瓶颈)：<br>$$<br>TP_{max}&#x3D;\frac{1}{max{\Delta t_i}}<br>$$</p>
</li>
</ol>
<p><strong>消除瓶颈的方法</strong>：</p>
<ul>
<li>细分瓶颈段</li>
<li>重复设置瓶颈段</li>
</ul>
<h4 id="b-实际吞吐率"><a href="#b-实际吞吐率" class="headerlink" title="b.实际吞吐率"></a>b.实际吞吐率</h4><p>实际吞吐率$TP$：$m$段流水线完成$n$个任务的吞吐率。</p>
<ol>
<li><p>若各段时间相等，均为$\Delta t_0$：<br>$$<br>T_{流水}&#x3D;m\Delta t_0+(n-1)\Delta t_0\<br>TP&#x3D;\frac{n}{T_{流水}}&#x3D;\frac{TP_{max}}{1+\frac{m-1}{n}}<br>\n&gt;&gt;m:TP&gt;&gt;TP_{max}<br>$$</p>
</li>
<li><p>若各段时间不等，第$i$段时间为$\Delta t_i$：<br>$$<br>T&#x3D;\sum^m_{i&#x3D;1}\Delta t_i+(n-1)\Delta t_j,\Delta t_j&#x3D;max{\Delta t_i}\<br>TP&#x3D;\frac {n}{T}<br>$$</p>
</li>
</ol>
<h3 id="2-加速比"><a href="#2-加速比" class="headerlink" title="(2)加速比"></a>(2)加速比</h3><p>加速比$S$指的是流水线速度与等功能的<strong>非流水线</strong>速度之比。</p>
<ol>
<li><p>各段时间相等：<br>$$<br>S&#x3D;\frac {T_{非流水}}{T_{流水}}&#x3D;\frac{nm\Delta t_0}{m\Delta t_0+(n-1)\Delta t_0}&#x3D;\frac{m}{1+\frac{m-1}{n}}<br>$$</p>
</li>
<li><p>各段时间不等：<br>$$<br>S&#x3D;\frac{n\sum^m_{i&#x3D;1}\Delta t_i}{\sum^m_{i&#x3D;1}\Delta t_i+(n-1)\Delta t_{max}}<br>$$</p>
</li>
</ol>
<h3 id="3-效率"><a href="#3-效率" class="headerlink" title="(3)效率"></a>(3)效率</h3><p>效率指流水线的<strong>设备利用率</strong>。</p>
<blockquote>
<p>流水线并不是一直满负荷工作，刚开始有通过时间(CD)，结束时有排空时间。</p>
</blockquote>
<ol>
<li><p>各段时间相等：<br>$$<br>E&#x3D;\frac{n}{m+n-1}<br>$$</p>
</li>
<li><p>各段时间不等：<br>$$<br>E&#x3D;\frac{n个任务占用的时空区}{m个段总的时间区}<br>$$</p>
</li>
</ol>
<h3 id="4-相关关系"><a href="#4-相关关系" class="headerlink" title="(4)相关关系"></a>(4)相关关系</h3><ol>
<li><p>效率是实际加速比$S$与$m$($m$段流水线)之比。<br>$$<br>E&#x3D;\frac{m n\Delta t_0}{mT_{流水}}&#x3D;\frac{S}{m}<br>$$</p>
</li>
<li><p>当$\Delta t_0$不变时，流水线的效率与吞吐率成正比。<br>$$<br>E&#x3D;TP\Delta t_0<br>$$</p>
</li>
<li><p>当$m$和$\Delta t_0$不变时，流水线的加速比与吞吐率呈正比。<br>$$<br>TP&#x3D;\frac{S}{m\Delta t_0}<br>$$</p>
</li>
</ol>
<p><img src="https://s1.ax1x.com/2022/10/11/xNIDXD.png"></p>
<p><img src="https://s1.ax1x.com/2022/10/12/xU9TzD.png"></p>
<h3 id="5-结论"><a href="#5-结论" class="headerlink" title="(5)结论"></a>(5)结论</h3><ul>
<li>流水线并不能减少单条指令的执行时间，但是可以提高吞吐率。</li>
<li>流水线深度↑，流水线性能↑</li>
<li>流水线深度<strong>受限于流水线延迟与额外开销</strong>。</li>
<li>流水线寄存器使用<strong>高速锁存器</strong>。</li>
<li>指令之间的相关，限制了流水线的性能。</li>
</ul>
<h2 id="四、流水线中的相关"><a href="#四、流水线中的相关" class="headerlink" title="四、流水线中的相关"></a>四、流水线中的相关</h2><p>流水线中的相关是指相邻or相近的两条指令<strong>因存在某种关联，后一条指令不能在原先指定的时钟周期开始执行</strong>。</p>
<blockquote>
<p>basic solution：暂停</p>
<p>暂停流水线中某条指令及其后面所有指令的执行，该指令之前的所有指令继续执行。</p>
</blockquote>
<p>全局性相关：转移指令引起的<strong>控制相关</strong>，对于流水计算机吞吐率、效率的影响比数据相关<strong>严重得多</strong>。</p>
<p>局部性相关：一般这么称呼<strong>数据相关</strong>。</p>
<h3 id="1-结构相关"><a href="#1-结构相关" class="headerlink" title="(1)结构相关"></a>(1)结构相关</h3><p>当指令在重叠执行的过程中，硬件资源满足不了指令重叠执行的要求，发生资源冲突。</p>
<blockquote>
<p>比如存储器不能在同一时刻既取指又存数。</p>
</blockquote>
<p><strong>导致结构相关的常见原因</strong>：</p>
<ul>
<li>功能部件不是全流水</li>
<li>重复设置的资源数量不足</li>
</ul>
<p><strong>解决方法</strong>：</p>
<ul>
<li>插入暂停周期（<em>等到可以继续执行的时间</em>）</li>
<li>设置相互独立的指令存储器和数据存储器或者是<code>Cache</code>（<em>实际上也是对存储器流水化了，设置了多个段这样，还是增加了硬件资源</em>）</li>
</ul>
<h3 id="2-数据相关"><a href="#2-数据相关" class="headerlink" title="(2)数据相关"></a>(2)数据相关</h3><p>因一条指令需要用到前面指令的结果，而无法与产生结果的指令重叠执行。</p>
<p><strong>产生原因</strong>：当很多指令在执行的时候，读写操作数的顺序可能会改变，从而导致结果改变。</p>
<p>举个栗子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//写后读RAW</span></span><br><span class="line">MOV AX,<span class="number">1000</span></span><br><span class="line">MOV BL,<span class="number">123</span></span><br><span class="line">DIV BL<span class="comment">//AX=AX/BL</span></span><br><span class="line">MOV BX,AX<span class="comment">//BX=AX</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于第三条<code>DIV</code>指令，由于使除法，所以执行的很慢；但是由于流水线的存在，在<code>DIV</code>执行的时候，<code>MOV</code>指令也开始取指准备执行。但是<code>MOV</code>指令要使用<code>AX</code>，但是此时缓慢的<code>DIV</code>还在执行，没有将结果写入<code>AX</code>······</p>
</blockquote>
<h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><p>设有两条指令<code>i</code>和<code>j</code>，都会访问同一寄存器<code>R</code>。</p>
<ul>
<li><strong>RAW写后读</strong></li>
</ul>
<p>若<code>j</code>在<code>i</code>完成写之前从<code>R</code>中读出数据，会得到错误的结果（如上面的栗子）。</p>
<ul>
<li><strong>WAW写后写</strong></li>
</ul>
<p>若<code>j</code>在<code>i</code>之前完成写操作，<code>R</code>中保存错误的结果。</p>
<ul>
<li><strong>WAR读后写</strong></li>
</ul>
<p>若<code>j</code>先将数据写入<code>R</code>，<code>i</code>将读出错误的结果。</p>
<blockquote>
<p>RAR不会引起数据相关。</p>
</blockquote>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><p><strong>向流水线中插入暂停周期</strong>。</p>
<ul>
<li>采用直通技术</li>
</ul>
<p>控制逻辑将前面指令的结果从其产生的地方直接连通到当前指令所处的位置。</p>
<blockquote>
<p>就没有存放这一步骤（暂时），因为浪费时间。</p>
</blockquote>
<p><img src="https://s1.ax1x.com/2022/10/13/xd3T4x.png"></p>
<ul>
<li>增加专用硬件</li>
</ul>
<p>增加流水线互锁硬件(<code>interlock</code>)。互锁硬件先要检测流水线中指令的数据相关性，当互锁硬件发现数据相关是，使流水线工作停顿下来，直到相关消失为止。</p>
<ul>
<li>利用编译器</li>
</ul>
<p>流水线调度：编译器可以对指令<strong>重新排序或插入空操作指令</strong>，使得加载任何冲突数据的操作被延迟，但对重新逻辑or输出不受影响。</p>
<blockquote>
<p>在编译器这一步就对指令的执行顺序做出调整。</p>
</blockquote>
<h3 id="3-控制相关"><a href="#3-控制相关" class="headerlink" title="(3)控制相关"></a>(3)控制相关</h3><p>当流水线遇到分支指令和其它会改变PC值的指令。</p>
<blockquote>
<p>无条件跳转、条件跳转</p>
</blockquote>
<p>那么其实无条件跳转相对来说好处理一点，在无条件转移指令之类的指令必须执行；但是对于条件转移，<strong>它有一个判断跳转到哪、做决策</strong>的过程。</p>
<blockquote>
<p>条件分支指令对于流水线性能的影响远比无条件转移指令要大。</p>
</blockquote>
<p><strong>所以，其实重点就是，如何对条件转移指令进行处理</strong>。</p>
<p><strong>(1)冻结流水线</strong></p>
<p><strong>用于早期CPU，已过时</strong>。一旦在指令译码段检测到分支指令，就在转移目标地址确定之前保存or删除所有紧随分支指令之后的指令，当分支指令从执行段流出，确定出新的PC值时，流水线才继续根据新的PC值填充流水线。</p>
<blockquote>
<p>这会严重影响流水线的性能。</p>
</blockquote>
<p><strong>(2)预取分支目标</strong></p>
<p>在条件分支指令被识别时，除了紧随其后的指令外，分支目标也被预取放在当前流水线，并保存到分支指令被执行。</p>
<blockquote>
<p>分支目标 已经进行了取指等操作。</p>
</blockquote>
<p>如果分支跳转发生，已预取的目标指令可立刻执行。</p>
<p><strong>(3)多流</strong></p>
<p>在条件分支的两路上<strong>同时启动取指令操作</strong>，并将指令保存到分支指令被实际执行时。</p>
<blockquote>
<p>就是对于预取分支目标的扩展。但是个人感觉开销可能会更大？</p>
</blockquote>
<p><strong>(4)循环缓冲器</strong></p>
<p><strong>什么是循环缓冲器？</strong>是一个小的、非常高速的存储器。</p>
<p>循环缓冲器中保存着最近获取的n条<strong>顺序</strong>的指令。若分支发生，硬件先检查分支目标是否在缓冲器中；如果在，下一条指令从缓冲器中获取。</p>
<blockquote>
<p>它的好处是：</p>
<ul>
<li>当分支未发生时，顺序获取的指令已在缓冲器中。</li>
<li>如果它的容量比较大(可以满足循环中的全部指令)，则循环中的指令只需要从内存中读出一次。</li>
<li>假如它的容量比较大(但是也没有那么大，但也不小，指目标地址仅仅是在分支指令之后的几个单元处)，当分支发生时，目标已在缓冲器中。<em>应用：普通的if-then-else语句</em></li>
</ul>
</blockquote>
<h4 id="分支预测"><a href="#分支预测" class="headerlink" title="分支预测"></a>分支预测</h4><h5 id="静态分支预测"><a href="#静态分支预测" class="headerlink" title="静态分支预测"></a>静态分支预测</h5><p>可以采用的预测方法：</p>
<ul>
<li>出错检测处理：预测分支不会发生。</li>
<li>循环：预测分支总是发生。</li>
<li>编译器预测(有先验预测)</li>
<li>剖面法：实际运行该程序(模拟器上)，然后将有关信息送给编译器。(作弊，有后验预测)</li>
</ul>
<p><strong>如果预测错了咋办</strong>？</p>
<ul>
<li><p>对于已经执行的指令，其结果保存在临时寄存器中。</p>
</li>
<li><p>对于将要执行的指令，把将要被覆盖的寄存器的原值保存在临时寄存器中。</p>
</li>
</ul>
<h5 id="动态分支预测"><a href="#动态分支预测" class="headerlink" title="动态分支预测"></a>动态分支预测</h5><p>分支历史表：也称为分支预测缓存。下面是一个栗子：</p>
<p><img src="https://s1.ax1x.com/2022/10/13/xdyYe1.png"></p>
<h4 id="延迟分支"><a href="#延迟分支" class="headerlink" title="延迟分支"></a>延迟分支</h4><p>流水线遇到分支指令时，按照正常方式处理，同时执行延迟槽中的指令。</p>
<blockquote>
<p>分支延迟槽：程序中位于转移指令后面的存储单元的位置。</p>
</blockquote>
<h5 id="延迟转移技术"><a href="#延迟转移技术" class="headerlink" title="延迟转移技术"></a>延迟转移技术</h5><ol>
<li>对于放入延迟槽中的指令需满足：<ul>
<li>被转移指令在移动过程中与所经过的指令之间没有数据相关。</li>
<li>被移动指令不破坏条件码，至少不影响后面的指令使用条件码。</li>
</ul>
</li>
<li>如果找不到符合上述条件的指令，须在条件转移指令后插入空操作NOP。</li>
<li>若指令的执行过程分为多个流水段，则需插入多条指令。</li>
</ol>
<p><strong>延迟槽调度</strong>：编译器的任务就是在延迟槽中放入有用的指令。有以下三种调度方法：</p>
<ul>
<li>从分支前(before)调入</li>
<li>从目标处(target)调入</li>
<li>从失败处(fall-through)调入</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/10/13/xd6mXd.png"></p>
<h5 id="指令取消技术"><a href="#指令取消技术" class="headerlink" title="指令取消技术"></a>指令取消技术</h5><p>如果采用延迟转移技术，<strong>经常会找不到可以用来调整的指令</strong>。</p>
<p><strong>向后转移</strong>(适用于循环程序)：</p>
<ol>
<li><strong>循环体的第一条指令</strong>安放在两个位置，分别在循环体的前面和后面。</li>
<li><code>if</code>转移成功，则执行转移指令(循环体)后面的指令，然后转移到目标地址；</li>
<li><code>else</code>，取消转移指令(循环体)后面的指令。</li>
</ol>
<p><strong>向前转移</strong>：</p>
<ol>
<li><code>if</code>转移不成功，执行转移指令之后的下条指令；</li>
<li><code>else</code>取消下条指令，转移到目标地址执行。</li>
</ol>
<p><img src="https://s1.ax1x.com/2022/10/13/xdc0rd.png"></p>
<h2 id="五、指令级并行"><a href="#五、指令级并行" class="headerlink" title="五、指令级并行"></a>五、指令级并行</h2><p>当指令不相关时，它们在流水线中重叠执行，这种指令间潜在的并行性称为指令级并行。</p>
<p>指令流水线的<strong>限制</strong>：增加<strong>指令发射的宽度</strong>和<strong>指令流水线的深度</strong>，要求复杂硬件电路和高频率时钟的支持。<strong>导致CPU功耗up</strong>。</p>
<blockquote>
<p><strong>功耗时限制当代处理器发展的首要因素</strong>。</p>
</blockquote>
<p><strong>突破限制的途径</strong>：</p>
<ul>
<li>流水线深度</li>
<li>从更深层次解决流水线中可能存在的各种相关性</li>
<li>多核CPU，多指令流水线</li>
<li>提高指令级并行的技术<ul>
<li>乱序执行</li>
<li>寄存器重命名</li>
<li>推测执行</li>
</ul>
</li>
</ul>
<h4 id="提高指令性并行的技术"><a href="#提高指令性并行的技术" class="headerlink" title="提高指令性并行的技术"></a>提高指令性并行的技术</h4><h5 id="乱序执行-寄存器重命名"><a href="#乱序执行-寄存器重命名" class="headerlink" title="乱序执行&amp;寄存器重命名"></a>乱序执行&amp;寄存器重命名</h5><p>乱序执行：跳过相关的指令取执行后面不相关的指令，使得指令的执行顺序不再按原程序的顺序执行。</p>
<blockquote>
<p>要求指令调度算法必须保障程序的运行结果和按照顺序执行时的结果相同。</p>
</blockquote>
<p>寄存器重命名技术：使用隐秘寄存器对寄存器重命名，<strong>可有效地减少WAR和WAW相关</strong>。</p>
<blockquote>
<p>好处：使用乱序执行&amp;寄存器重命名，可以把运算速度几乎提高到原来的两倍。</p>
<p>坏处：乱序完成使得中断不精确。</p>
</blockquote>
<h5 id="推测执行"><a href="#推测执行" class="headerlink" title="推测执行"></a>推测执行</h5><p>在不知道是否需要执行之前就执行代码的技术。</p>
<blockquote>
<ul>
<li>需要编译器和硬件的支持。</li>
<li>需要对体系结果进行扩展。</li>
</ul>
</blockquote>
<p>对于推测执行，分为：</p>
<ol>
<li>硬件推测：基于动态调度的分支的扩展。<ul>
<li>在分支预测的结果时正确的情况下，硬件推测将按照预测的结果取指、发射指令并执行指令。</li>
<li>动态调度仅获得和发射指令。</li>
</ul>
</li>
<li>软件推测：编译器。</li>
</ol>
<p><img src="https://s1.ax1x.com/2022/10/13/xdgOtP.png"></p>
<h4 id="多指令发射技术"><a href="#多指令发射技术" class="headerlink" title="多指令发射技术"></a>多指令发射技术</h4><p>一个时钟周期内流出多条指令，CPI(Cycles Per Instructions)&lt;1，IPC&gt;1。</p>
<p>对于多指令流出处理器有三种基本结构：</p>
<ul>
<li>超标量(编译器静态调度or动态调度)</li>
<li>超流水：将每个功能部件进一步流水化，特別是取指or指令流出被分解为多段。</li>
<li>超长指令字：把很多条指令综合成一条超级长的指令，只能使用编译静态调度。</li>
</ul>
<h4 id="指令级高度并行的超级处理器"><a href="#指令级高度并行的超级处理器" class="headerlink" title="指令级高度并行的超级处理器"></a>指令级高度并行的超级处理器</h4><p>主要分为以下三种:</p>
<ul>
<li>超标量：内置多个流水线(不是流水线的段噢，是多个多个多个流水线)</li>
<li>超流水线：将流水线的<code>IF,AD,ALU</code>等关键步骤进一步细分为多个阶段。</li>
<li>超标量超流水线：多流水线+指令级细分</li>
</ul>
<p><img src="https://s1.ax1x.com/2022/10/13/xd2lA1.png"></p>
<blockquote>
<p>就是说在没有看到结果之前，可能有一些人(比如我)会觉得：超标量很好，超流水线也很好，那么综合得到的超标量超流水线应当是集二家之长，性能更优才对；为什么得到的结果会是：超标量&gt;超标量超流水线&gt;超流水线呢？</p>
<p><em>主要是因为，实际上超流水线是很理想的，难以实现。但是超标量结构就比较简单酱。因此将不现实的与简单实际的融合···</em></p>
</blockquote>
<p>以下是正经解释(雾)：</p>
<p><img src="https://s1.ax1x.com/2022/10/13/xd2540.png"></p>
<p>最后，以上关于流水线，主要是工作在单处理器的情况下。于是提出了对于现在常用的多核处理器运用流水线技术：</p>
<p>这实际上是将<strong>指令级并行提升至线程级并行</strong>。是目前为止可以替代并超越<strong>超标量&amp;超长指令字</strong>(现在运用最多？反正就是最优的选择)的最佳选择。</p>
</div><div class="post-end"><div class="post-prev"><a href="/2022/10/19/JDBC/" title="上一篇文章"><i class="fa-solid fa-chevron-left fa-lg"></i></a></div><div class="post-reward" onclick="openPostReward()" title="赞赏"><i class="fa-regular fa-thumbs-up fa-xl fa-beat-fade"></i></div><div id="reward-panel" onclick="closePostReward()"><div class="reward-container"><p>如果您喜欢这篇文章，欢迎赞赏支持作者，谢谢&#128151;</p>
<div class="reward-nav"><div class="reward-item"><img class="reward-img" src="/img/reward/wechat.jpg" title="Wechat" alt="Wechat"/><span>Wechat</span></div><div class="reward-item"><img class="reward-img" src="/img/reward/alipay.jpg" title="Alipay" alt="Alipay"/><span>Alipay</span></div></div></div></div><div class="post-next"><a href="/2022/10/13/%E5%B5%8C%E5%85%A5%E5%BC%8F%E4%B8%8A%E6%9C%BA%E5%AE%9E%E9%AA%8C1/" title="下一篇文章"><i class="fa-solid fa-chevron-right fa-lg"></i></a></div></div></article><div class="comment" id="comment"><script src="https://giscus.app/client.js" async="async"></script></div><div id="post-toc"><aside class="toc-aside"><div class="toc-title"><span><i class="fa-solid fa-paw"></i>目录</span></div><div class="toc-container" id="toc-body"><ol class="toc-content"><li class="toc-content-item toc-content-level-1"><a class="toc-content-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="toc-content-number">1.</span> <span class="toc-content-text">流水线</span></a><ol class="toc-content-child"><li class="toc-content-item toc-content-level-2"><a class="toc-content-link" href="#%E4%B8%80%E3%80%81%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-content-number">1.1.</span> <span class="toc-content-text">一、流水线的特点</span></a></li><li class="toc-content-item toc-content-level-2"><a class="toc-content-link" href="#%E4%BA%8C%E3%80%81%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%B1%BB%E5%9E%8B"><span class="toc-content-number">1.2.</span> <span class="toc-content-text">二、流水线类型</span></a></li><li class="toc-content-item toc-content-level-2"><a class="toc-content-link" href="#%E4%B8%89%E3%80%81%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%9A%84%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-content-number">1.3.</span> <span class="toc-content-text">三、流水线的性能分析</span></a><ol class="toc-content-child"><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#1-%E5%90%9E%E5%90%90%E7%8E%87"><span class="toc-content-number">1.3.1.</span> <span class="toc-content-text">(1)吞吐率</span></a><ol class="toc-content-child"><li class="toc-content-item toc-content-level-4"><a class="toc-content-link" href="#a-%E6%9C%80%E5%A4%A7%E5%90%9E%E5%90%90%E7%8E%87"><span class="toc-content-number">1.3.1.1.</span> <span class="toc-content-text">a.最大吞吐率</span></a></li><li class="toc-content-item toc-content-level-4"><a class="toc-content-link" href="#b-%E5%AE%9E%E9%99%85%E5%90%9E%E5%90%90%E7%8E%87"><span class="toc-content-number">1.3.1.2.</span> <span class="toc-content-text">b.实际吞吐率</span></a></li></ol></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#2-%E5%8A%A0%E9%80%9F%E6%AF%94"><span class="toc-content-number">1.3.2.</span> <span class="toc-content-text">(2)加速比</span></a></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#3-%E6%95%88%E7%8E%87"><span class="toc-content-number">1.3.3.</span> <span class="toc-content-text">(3)效率</span></a></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#4-%E7%9B%B8%E5%85%B3%E5%85%B3%E7%B3%BB"><span class="toc-content-number">1.3.4.</span> <span class="toc-content-text">(4)相关关系</span></a></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#5-%E7%BB%93%E8%AE%BA"><span class="toc-content-number">1.3.5.</span> <span class="toc-content-text">(5)结论</span></a></li></ol></li><li class="toc-content-item toc-content-level-2"><a class="toc-content-link" href="#%E5%9B%9B%E3%80%81%E6%B5%81%E6%B0%B4%E7%BA%BF%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3"><span class="toc-content-number">1.4.</span> <span class="toc-content-text">四、流水线中的相关</span></a><ol class="toc-content-child"><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#1-%E7%BB%93%E6%9E%84%E7%9B%B8%E5%85%B3"><span class="toc-content-number">1.4.1.</span> <span class="toc-content-text">(1)结构相关</span></a></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#2-%E6%95%B0%E6%8D%AE%E7%9B%B8%E5%85%B3"><span class="toc-content-number">1.4.2.</span> <span class="toc-content-text">(2)数据相关</span></a><ol class="toc-content-child"><li class="toc-content-item toc-content-level-4"><a class="toc-content-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-content-number">1.4.2.1.</span> <span class="toc-content-text">分类</span></a></li><li class="toc-content-item toc-content-level-4"><a class="toc-content-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="toc-content-number">1.4.2.2.</span> <span class="toc-content-text">解决方法</span></a></li></ol></li><li class="toc-content-item toc-content-level-3"><a class="toc-content-link" href="#3-%E6%8E%A7%E5%88%B6%E7%9B%B8%E5%85%B3"><span class="toc-content-number">1.4.3.</span> <span class="toc-content-text">(3)控制相关</span></a><ol class="toc-content-child"><li class="toc-content-item toc-content-level-4"><a class="toc-content-link" href="#%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B"><span class="toc-content-number">1.4.3.1.</span> <span class="toc-content-text">分支预测</span></a><ol class="toc-content-child"><li class="toc-content-item toc-content-level-5"><a class="toc-content-link" href="#%E9%9D%99%E6%80%81%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B"><span class="toc-content-number">1.4.3.1.1.</span> <span class="toc-content-text">静态分支预测</span></a></li><li class="toc-content-item toc-content-level-5"><a class="toc-content-link" href="#%E5%8A%A8%E6%80%81%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B"><span class="toc-content-number">1.4.3.1.2.</span> <span class="toc-content-text">动态分支预测</span></a></li></ol></li><li class="toc-content-item toc-content-level-4"><a class="toc-content-link" href="#%E5%BB%B6%E8%BF%9F%E5%88%86%E6%94%AF"><span class="toc-content-number">1.4.3.2.</span> <span class="toc-content-text">延迟分支</span></a><ol class="toc-content-child"><li class="toc-content-item toc-content-level-5"><a class="toc-content-link" href="#%E5%BB%B6%E8%BF%9F%E8%BD%AC%E7%A7%BB%E6%8A%80%E6%9C%AF"><span class="toc-content-number">1.4.3.2.1.</span> <span class="toc-content-text">延迟转移技术</span></a></li><li class="toc-content-item toc-content-level-5"><a class="toc-content-link" href="#%E6%8C%87%E4%BB%A4%E5%8F%96%E6%B6%88%E6%8A%80%E6%9C%AF"><span class="toc-content-number">1.4.3.2.2.</span> <span class="toc-content-text">指令取消技术</span></a></li></ol></li></ol></li></ol></li><li class="toc-content-item toc-content-level-2"><a class="toc-content-link" href="#%E4%BA%94%E3%80%81%E6%8C%87%E4%BB%A4%E7%BA%A7%E5%B9%B6%E8%A1%8C"><span class="toc-content-number">1.5.</span> <span class="toc-content-text">五、指令级并行</span></a><ol class="toc-content-child"><li class="toc-content-item toc-content-level-4"><a class="toc-content-link" href="#%E6%8F%90%E9%AB%98%E6%8C%87%E4%BB%A4%E6%80%A7%E5%B9%B6%E8%A1%8C%E7%9A%84%E6%8A%80%E6%9C%AF"><span class="toc-content-number">1.5.0.1.</span> <span class="toc-content-text">提高指令性并行的技术</span></a><ol class="toc-content-child"><li class="toc-content-item toc-content-level-5"><a class="toc-content-link" href="#%E4%B9%B1%E5%BA%8F%E6%89%A7%E8%A1%8C-%E5%AF%84%E5%AD%98%E5%99%A8%E9%87%8D%E5%91%BD%E5%90%8D"><span class="toc-content-number">1.5.0.1.1.</span> <span class="toc-content-text">乱序执行&amp;寄存器重命名</span></a></li><li class="toc-content-item toc-content-level-5"><a class="toc-content-link" href="#%E6%8E%A8%E6%B5%8B%E6%89%A7%E8%A1%8C"><span class="toc-content-number">1.5.0.1.2.</span> <span class="toc-content-text">推测执行</span></a></li></ol></li><li class="toc-content-item toc-content-level-4"><a class="toc-content-link" href="#%E5%A4%9A%E6%8C%87%E4%BB%A4%E5%8F%91%E5%B0%84%E6%8A%80%E6%9C%AF"><span class="toc-content-number">1.5.0.2.</span> <span class="toc-content-text">多指令发射技术</span></a></li><li class="toc-content-item toc-content-level-4"><a class="toc-content-link" href="#%E6%8C%87%E4%BB%A4%E7%BA%A7%E9%AB%98%E5%BA%A6%E5%B9%B6%E8%A1%8C%E7%9A%84%E8%B6%85%E7%BA%A7%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-content-number">1.5.0.3.</span> <span class="toc-content-text">指令级高度并行的超级处理器</span></a></li></ol></li></ol></li></ol></li></ol></div></aside><div class="toc-blank" onclick="tocToggle()"></div></div></div></div><div id="tool-bar"><div id="tool-bar-main"><div id="tool-toggle" onclick="toolToggle()" title="设置"><i class="fa-solid fa-gear"></i></div><div id="toc-toggle" onclick="tocToggle()" title="目录"><i class="fa-solid fa-list-ul"></i></div><div id="go-to-comment" onclick="gotoComment()" title="评论"><i class="fa-regular fa-message fa-flip-horizontal"></i></div><div id="back-to-top" onclick="scrollToTop()" title="返回顶部"><i class="fa-solid fa-chevron-up"></i></div></div><div id="tool-bar-more" style="display: none;"><div id="darkmode-switch" onclick="darkmodeSwitch()" title="深色模式"><i class="fa-solid fa-circle-half-stroke"></i></div><div id="font-size-increase" onclick="fontSizeIncrease()" title="放大字体"><i class="fa-solid fa-plus"></i></div><div id="font-size-decrease" onclick="fontSizeDecrease()" title="缩小字体"><i class="fa-solid fa-minus"></i></div></div></div><div id="search-panel"><div class="search-container"><div class="search-head"><div class="search-title"><span><i class="fa-solid fa-paw"></i>搜索</span></div><div class="search-close-btn" onclick="toggleSearchWindow()"><i class="fa-regular fa-circle-xmark"></i></div></div><div class="search-box"><i class="fa-solid fa-magnifying-glass"></i><input id="search-input" type="text" placeholder="请输入需要搜索的内容……" value=""/></div><div class="search-body"><div id="search-count">匹配结果数: </div><div id="search-result"></div><div id="search-result-empty">未搜索到匹配的文章。</div></div></div></div><footer><div class="footer-content"><div class="copyright-info"><i class="fa-regular fa-copyright fa-xs"></i><span>2024 </span><a href="/about">Schwertlilien</a><i class="fa-solid fa-cat fa-sm"></i><span>Powered by </span><a href="https://hexo.io/" target="_blank">Hexo</a><span> &amp; </span><a href="https://github.com/chanwj/hexo-theme-meow" target="_blank" title="v2.1.0">Theme Meow</a></div><div class="pageview-site"><span id="busuanzi_container_site_pv">总访问量 : <span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner"></i></span></span><span id="busuanzi_container_site_uv">总访客数 : <span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner"></i></span></span></div></div></footer>
<script>const GLOBAL_CONFIG = {
  comment: { theme: ''}
}
</script>
<script src="/js/third-party/darkmode.js"></script>
<script>var options = {
  dark: '/css/darkmode.css',
  startAt: '24:00',
  endAt: '06:00',
  checkSystemScheme: 'false',
  saveOnToggle: 'true'
};
var darkMode = new DarkMode(options);
// change comment theme synchronously 同步修改评论区主题
if (darkMode.getMode() == "dark" && (true || true)) {
  if (document.getElementById('comment')) {
    document.getElementById('comment').getElementsByTagName('script')[0].setAttribute('data-theme', 'noborder_dark');
  }
}
</script><script>if (localStorage.getItem('font-size')) {
  document.querySelector('.post-content').style.fontSize = localStorage.getItem('font-size') + 'px';
}
</script>
<script src="/js/theme/tool-bar.js"></script>


<script src="/js/theme/menu.js"></script>


<script src="/js/third-party/clipboard.min.js"></script>


<script src="/js/theme/copy.js"></script>
<script>copyCode();
</script>
<script src="/js/theme/reward.js"></script>

<script src="/js/jquery-3.7.1.min.js"></script>


<script src="/js/theme/search.js"></script>
<script>searchFunc('/search.xml', 'search-input', 'search-result');
</script></body></html>